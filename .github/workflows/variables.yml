name: Bash File Test

on:
  push:
    branches:
      - main
env:
  BASHFILE_ENV_DEV: system_var_dev_sf.sh
  DIR_SYS_WIDE_LINUX: /etc/profile.d


jobs:
  run-github-actions:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Fetch code
        run: |
          pwd 
          ls -l
      - name: Decrypt file
        run: sudo gpg --quiet --batch --yes --decrypt --passphrase="$PASSPHRASE" --output $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV system_var_dev_sf.sh.gpg
        env:
          PASSPHRASE: ${{ secrets.PASSPHRASE }}
      - name: Print our files contents    
        run: cat $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV
      - name: Set up Linux Dev Env Variables
        run: |
          sudo chmod 777 $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV
          source $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV
          echo $PSQL_JDBC_URL
      - name: Access Variable Last Step 
        run: |
          source $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV
          echo "Let me see: $PSQL_JDBC_URL"
      - name: Generate a Intermediate File for $GITHUB_ENV
        run: |
          sudo sed 's/export //g' $DIR_SYS_WIDE_LINUX/$BASHFILE_ENV_DEV > ${HOME}/intermediate.txt
          sudo sed 's/"//g' ${HOME}/intermediate.txt > ${HOME}/intermediate1.txt
          sudo sed "s/'//g" ${HOME}/intermediate1.txt > ${HOME}/intermediate2.txt
          sudo sed -e 's/^\|$/"/g' ${HOME}/intermediate2.txt > ${HOME}/intermediate3.txt
          echo "**************************** START WHILE ********************"
          while read -r line; do echo "action_state=I'm here!!!" >> $GITHUB_ENV; done < ${HOME}/intermediate3.txt
      - name: Use the value
        id: step_two
        run: |
          echo "${{ env.action_state }}" # This will output 'yellow'
          
